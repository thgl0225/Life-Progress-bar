<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Progress Widget</title>
    <style>
        body {
            font-family: 'Pretendard', 'Arial', sans-serif;
            /* **ìˆ˜ì • 1: body ë°°ê²½ìƒ‰ì„ íˆ¬ëª…ìœ¼ë¡œ ë³€ê²½** */
            background-color: transparent; 
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            /* **ìˆ˜ì • 2: container ë°°ê²½ìƒ‰ì„ íˆ¬ëª…ìœ¼ë¡œ ë³€ê²½** */
            background-color: transparent; 
            width: 100%;
            max-width: 420px; 
            padding: 15px; 
            border-radius: 12px;
            box-shadow: none; /* ì»¨í…Œì´ë„ˆì˜ ê·¸ë¦¼ì ì œê±° */
            text-align: center;
            font-size: 13px; 
            border: none; 
        }

        h3 {
            display: none;
        }

        /* --- ì„¤ì • í† ê¸€ ë²„íŠ¼ (âš™ï¸ ì´ëª¨ì§€) ìŠ¤íƒ€ì¼ --- */
        .toggle-button {
            cursor: pointer;
            font-size: 16px; 
            color: #2c3e50; 
            user-select: none; 
            opacity: 0.2; 
            transition: opacity 0.3s ease; 
        }
        .toggle-button:hover {
            opacity: 1; 
        }

        /* --- ì…ë ¥ ë° ë²„íŠ¼ ë ˆì´ì•„ì›ƒ: í† ê¸€ ëŒ€ìƒ (ì˜¤ë¥¸ìª½ ì •ë ¬) --- */
        .controls-area {
            display: flex;
            justify-content: flex-end; 
            align-items: center; 
            width: 100%;
            margin-bottom: 8px; 
            max-height: 100px; 
            opacity: 1;
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out, margin-bottom 0.5s ease-out;
        }

        .controls-area.hidden {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0; 
            padding: 0;
        }

        .input-group {
            display: flex;
            flex-direction: row; 
            align-items: center;
            gap: 2px;
            width: auto; 
            text-align: left;
            flex-grow: 0; 
            margin-right: 15px; 
        }

        label {
            font-size: 12px;
            color: #2c3e50; 
            width: auto; 
            min-width: 30px; 
            text-align: right; 
            font-weight: 600; 
            margin-right: 2px; 
        }

        input {
            padding: 4px 6px; 
            font-size: 12px; 
            width: 50px; 
            border: 1px solid #dcdcdc;
            border-radius: 6px; 
            background-color: #ffffff; 
            box-sizing: border-box;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05); 
            transition: all 0.3s ease;
            margin-right: 0; 
        }

        .input-group input:focus {
            border-color: #5fa8b4;
            background-color: #ffffff;
            box-shadow: 0 0 0 1px rgba(119, 196, 211, 0.2); 
            outline: none;
        }

        button {
            padding: 4px 8px; 
            background-color: #77c4d3;
            border: none;
            border-radius: 5px; 
            color: white;
            font-size: 12px; 
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(119, 196, 211, 0.4); 
            transition: all 0.3s ease;
            margin-left: 0; 
        }

        button:hover {
            background-color: #5fa8b4;
            box-shadow: 0 2px 5px rgba(119, 196, 211, 0.5);
            transform: translateY(-0.5px);
        }

        /* --- ìƒ‰ìƒ ì„ íƒê¸° ìŠ¤íƒ€ì¼ --- */
        .color-group {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-right: 15px;
            font-size: 12px;
            color: #2c3e50;
            font-weight: 600;
        }
        #colorPicker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 20px; 
            height: 20px;
            background: none;
            border: 1px solid #dcdcdc;
            cursor: pointer;
            padding: 0;
            border-radius: 4px;
        }
        #colorPicker::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        #colorPicker::-webkit-color-swatch {
            border: none;
            border-radius: 3px;
        }

        /* --- ì§„í–‰ë¥  ë°” ë ˆì´ì•„ì›ƒ --- */
        .progress-container {
            margin-top: 0; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 2px 0; 
            border-top: 1px dashed #e0e0e0;
            cursor: pointer; 
        }
        .progress-container:last-child {
            border-bottom: 1px dashed #e0e0e0;
        }
        .progress-container:hover {
            background-color: #f7f7f7; 
        }

        .progress-label {
            font-size: 13px;
            color: #2c3e50;
            text-align: left;
            width: 18%; 
            font-weight: 600;
        }

        .progress-bar {
            flex-grow: 1;
            height: 9px; 
            background-color: #e9eef3; 
            border-radius: 8px; 
            margin: 0 10px; 
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .progress {
            height: 100%;
            background: #77c4d3; 
            border-radius: 8px;
            width: 0;
            transition: width 0.5s ease-out;
            box-shadow: 0 0 3px rgba(119, 196, 211, 0.5);
        }

        p {
            font-size: 13px;
            color: #2c3e50;
            width: 8%; 
            text-align: right;
            font-weight: 600;
        }

        /* --- ìƒì„¸ í†µê³„ íŒì—… ìŠ¤íƒ€ì¼ (ì¤‘ì•™ ê³ ì •) --- */
        #detailPopup {
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 15px;
            width: 250px;
            z-index: 1000;
            display: none;
            text-align: left;
        }

        #detailPopup.visible {
            display: block;
        }

        #detailPopup h3 {
            display: block; 
            font-size: 14px;
            margin-top: 0;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 700;
        }

        #popupContent p {
            font-size: 12px;
            margin: 5px 0;
            color: #555;
            width: auto; 
            text-align: left;
        }
        #popupContent strong {
            color: #333;
            font-weight: 600;
        }
    </style>
    </head>
<body>

    <div class="container">
        
        <div style="width: 100%; text-align: right; margin-bottom: 5px;">
            <span class="toggle-button" onclick="toggleControls()">âš™ï¸</span>
        </div>

        <div class="controls-area hidden" id="controlsArea">
            <div class="input-group">
                <label for="currentAge">ë‚˜ì´</label>
                <input type="number" id="currentAge" value="30" min="0" max="120">
                
                <label for="expectedLife">ìˆ˜ëª…</label>
                <input type="number" id="expectedLife" value="90" min="50" max="120">
            </div>

            <div class="color-group">
                <label for="colorPicker">ìƒ‰ìƒ</label>
                <input type="color" id="colorPicker" value="#77c4d3" onchange="applyColor(this.value)">
            </div>

            <button onclick="updateProgress()">ê³„ì‚°</button>
        </div>
        <div class="progress-container" id="dayProgressContainer" onclick="showDetail('day')">
            <div class="progress-label">ì˜¤ëŠ˜</div>
            <div class="progress-bar">
                <div class="progress" id="dayProgress"></div>
            </div>
            <p id="dayStatus">0%</p>
        </div>

        <div class="progress-container" id="weekProgressContainer" onclick="showDetail('week')">
            <div class="progress-label">ì´ë²ˆ ì£¼</div>
            <div class="progress-bar">
                <div class="progress" id="weekProgress"></div>
            </div>
            <p id="weekStatus">0%</p>
        </div>

        <div class="progress-container" id="monthProgressContainer" onclick="showDetail('month')">
            <div class="progress-label">ì´ë²ˆ ë‹¬</div>
            <div class="progress-bar">
                <div class="progress" id="monthProgress"></div>
            </div>
            <p id="monthStatus">0%</p>
        </div>

        <div class="progress-container" id="yearProgressContainer" onclick="showDetail('year')">
            <div class="progress-label"><span id="yearLabel">2025</span>ë…„</div>
            <div class="progress-bar">
                <div class="progress" id="yearProgress"></div>
            </div>
            <p id="yearStatus">0%</p>
        </div>
        
        <div class="progress-container" id="lifeProgressContainer" onclick="showDetail('life')">
            <div class="progress-label">ì‹œê°„ì˜ íë¦„</div>
            <div class="progress-bar">
                <div class="progress" id="lifeProgress"></div>
            </div>
            <p id="lifeStatus">0%</p>
        </div>
        
        <div id="detailPopup" onclick="event.stopPropagation()">
            <div id="popupContent"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜: ìƒì„¸ í†µê³„ ê³„ì‚°ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
        let detailData = {}; 
        
        const MS_PER_DAY = 1000 * 60 * 60 * 24;
        const MS_PER_HOUR = 1000 * 60 * 60;

        // í˜„ì¬ ë‚ ì§œ ë° ì‹œê°„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (1ì´ˆë§ˆë‹¤ ë°˜ë³µë¨)
        function updateProgress() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth(); 
            const currentDay = currentDate.getDate();
            const currentHour = currentDate.getHours();
            const currentMinute = currentDate.getMinutes();
            const currentSecond = currentDate.getSeconds();

            const currentAge = parseInt(document.getElementById('currentAge').value) || 0;
            const expectedLife = parseInt(document.getElementById('expectedLife').value) || 90;
            
            // HTML ìš”ì†Œ
            const dayProgress = document.getElementById('dayProgress');
            const weekProgress = document.getElementById('weekProgress');
            const monthProgress = document.getElementById('monthProgress');
            const yearProgress = document.getElementById('yearProgress');
            const lifeProgress = document.getElementById('lifeProgress');
            document.getElementById('yearLabel').innerText = currentYear;


            // ----------------------------------------------------
            // ğŸ“Š 1. ì‹œê°„ì˜ íë¦„ (ì¸ìƒ) ê³„ì‚°
            // ----------------------------------------------------
            const startOfLife = new Date(currentYear - currentAge, currentMonth, currentDay, currentHour, currentMinute, currentSecond, currentDate.getMilliseconds()); 
            const endOfLife = new Date(startOfLife);
            endOfLife.setFullYear(startOfLife.getFullYear() + expectedLife);

            const lifeSpanMs = endOfLife - startOfLife;
            const currentLifeDurationMs = currentDate - startOfLife;
            let lifeProgressPercentage = (currentLifeDurationMs / lifeSpanMs) * 100;
            
            if (lifeProgressPercentage >= 0 && lifeProgressPercentage <= 100) {
                lifeProgress.style.width = lifeProgressPercentage + '%';
                document.getElementById('lifeStatus').innerText = `${Math.round(lifeProgressPercentage)}%`;
            } else if (lifeProgressPercentage > 100) {
                lifeProgress.style.width = '100%';
                document.getElementById('lifeStatus').innerText = `100%+`;
            } else {
                lifeProgress.style.width = '0%';
                document.getElementById('lifeStatus').innerText = `0%`;
            }

            // A. ì‹œê°„ì˜ íë¦„ (ì¸ìƒ) í†µê³„ ë°ì´í„° ì €ì¥
            const totalDaysLife = lifeSpanMs / MS_PER_DAY;
            const elapsedDaysLife = currentLifeDurationMs / MS_PER_DAY;
            const remainingDaysLife = totalDaysLife - elapsedDaysLife;

            detailData.life = `
                <p><strong>ì´ ìˆ˜ëª…:</strong> ${expectedLife}ë…„ (${Math.round(totalDaysLife)}ì¼)</p>
                <p><strong>ê²½ê³¼ ì‹œê°„:</strong> ${Math.floor(elapsedDaysLife)}ì¼</p>
                <p><strong>ë‚¨ì€ ì‹œê°„:</strong> ${Math.ceil(remainingDaysLife)}ì¼</p>
            `;


            // ----------------------------------------------------
            // ğŸ“Š 2. ì´ë²ˆ ë…„ë„ ê³„ì‚°
            // ----------------------------------------------------
            const startOfYear = new Date(currentYear, 0, 1);
            const endOfYear = new Date(currentYear + 1, 0, 1);
            const yearDurationMs = endOfYear - startOfYear;
            const yearProgressPercentage = ((currentDate - startOfYear) / yearDurationMs) * 100;
            yearProgress.style.width = yearProgressPercentage + '%';
            document.getElementById('yearStatus').innerText = `${Math.round(yearProgressPercentage)}%`;

            // B. ì´ë²ˆ ë…„ë„ í†µê³„ ë°ì´í„° ì €ì¥
            const elapsedDaysYear = (currentDate - startOfYear) / MS_PER_DAY;
            const totalDaysYear = (endOfYear - startOfYear) / MS_PER_DAY;
            const remainingDaysYear = totalDaysYear - elapsedDaysYear;
            
            detailData.year = `
                <p><strong>ì´ ì¼ìˆ˜:</strong> ${Math.round(totalDaysYear)}ì¼</p>
                <p><strong>ê²½ê³¼ ì¼ìˆ˜:</strong> ${Math.floor(elapsedDaysYear)}ì¼</p>
                <p><strong>ë‚¨ì€ ì¼ìˆ˜:</strong> ${Math.ceil(remainingDaysYear)}ì¼</p>
            `;


            // ----------------------------------------------------
            // ğŸ“Š 3. ì´ë²ˆ ë‹¬ ê³„ì‚°
            // ----------------------------------------------------
            const startOfMonth = new Date(currentYear, currentMonth, 1);
            const endOfMonth = new Date(currentYear, currentMonth + 1, 0, 23, 59, 59, 999);
            const monthDurationMs = endOfMonth - startOfMonth;
            const currentMonthDurationMs = currentDate - startOfMonth;
            const monthProgressPercentage = (currentMonthDurationMs / monthDurationMs) * 100;
            
            monthProgress.style.width = monthProgressPercentage + '%';
            document.getElementById('monthStatus').innerText = `${Math.round(monthProgressPercentage)}%`;

            // C. ì´ë²ˆ ë‹¬ í†µê³„ ë°ì´í„° ì €ì¥
            const totalDaysMonth = monthDurationMs / MS_PER_DAY;
            const elapsedDaysMonth = currentMonthDurationMs / MS_PER_DAY;
            const remainingDaysMonth = totalDaysMonth - elapsedDaysMonth;
            
            detailData.month = `
                <p><strong>ì´ ì¼ìˆ˜:</strong> ${Math.round(totalDaysMonth)}ì¼</p>
                <p><strong>ê²½ê³¼ ì¼ìˆ˜:</strong> ${elapsedDaysMonth.toFixed(1)}ì¼</p>
                <p><strong>ë‚¨ì€ ì¼ìˆ˜:</strong> ${Math.ceil(remainingDaysMonth)}ì¼</p>
            `;


            // ----------------------------------------------------
            // ğŸ“Š 4. ì´ë²ˆ ì£¼ ê³„ì‚°
            // ----------------------------------------------------
            const startOfWeek = new Date(currentDate);
            let dayOfWeek = currentDate.getDay(); 
            dayOfWeek = (dayOfWeek === 0) ? 7 : dayOfWeek; 
            const diffToMonday = 1 - dayOfWeek; 

            startOfWeek.setDate(currentDate.getDate() + diffToMonday); 
            startOfWeek.setHours(0, 0, 0, 0); 

            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 7);

            const weekDurationMs = endOfWeek - startOfWeek;
            const currentWeekDurationMs = currentDate - startOfWeek;
            const weekProgressPercentage = (currentWeekDurationMs / weekDurationMs) * 100;

            weekProgress.style.width = weekProgressPercentage + '%';
            document.getElementById('weekStatus').innerText = `${Math.round(weekProgressPercentage)}%`;

            // D. ì´ë²ˆ ì£¼ í†µê³„ ë°ì´í„° ì €ì¥
            const totalHoursWeek = 7 * 24;
            const elapsedHoursWeek = currentWeekDurationMs / MS_PER_HOUR;
            const remainingHoursWeek = totalHoursWeek - elapsedHoursWeek;
            
            detailData.week = `
                <p><strong>ì´ ì‹œê°„:</strong> ${totalHoursWeek}ì‹œê°„ (7ì¼)</p>
                <p><strong>ê²½ê³¼ ì‹œê°„:</strong> ${elapsedHoursWeek.toFixed(1)}ì‹œê°„</p>
                <p><strong>ë‚¨ì€ ì‹œê°„:</strong> ${remainingHoursWeek.toFixed(1)}ì‹œê°„</p>
            `;

            
            // ----------------------------------------------------
            // ğŸ“Š 5. ì˜¤ëŠ˜ ê³„ì‚°
            // ----------------------------------------------------
            const totalSecondsInDay = 24 * 60 * 60;
            const elapsedSeconds = currentHour * 3600 + currentMinute * 60 + currentSecond;
            const dayProgressPercentage = (elapsedSeconds / totalSecondsInDay) * 100;
            
            dayProgress.style.width = dayProgressPercentage + '%';
            document.getElementById('dayStatus').innerText = `${Math.round(dayProgressPercentage)}%`;

            // E. ì˜¤ëŠ˜ í†µê³„ ë°ì´í„° ì €ì¥
            const elapsedHoursDay = elapsedSeconds / 3600;
            const remainingHoursDay = 24 - elapsedHoursDay;

            detailData.day = `
                <p><strong>ì´ ì‹œê°„:</strong> 24ì‹œê°„</p>
                <p><strong>ê²½ê³¼ ì‹œê°„:</strong> ${elapsedHoursDay.toFixed(2)}ì‹œê°„</p>
                <p><strong>ë‚¨ì€ ì‹œê°„:</strong> ${remainingHoursDay.toFixed(2)}ì‹œê°„</p>
            `;
        }


        // ----------------------------------------------------
        // ğŸ¨ ìƒ‰ìƒ ë° í† ê¸€ ê¸°ëŠ¥ (ë³€ê²½ ì—†ìŒ)
        // ----------------------------------------------------
        function applyColor(color) {
            const progresses = document.querySelectorAll('.progress');
            progresses.forEach(progress => {
                progress.style.background = color;
            });
            localStorage.setItem('progressColor', color);
        }

        function loadAndApplyColor() {
            const savedColor = localStorage.getItem('progressColor');
            if (savedColor) {
                applyColor(savedColor);
                document.getElementById('colorPicker').value = savedColor;
            } else {
                applyColor('#77c4d3'); 
            }
        }

        function toggleControls() {
            const controls = document.getElementById('controlsArea');
            controls.classList.toggle('hidden');
        }

        // ----------------------------------------------------
        // ğŸ“Š ìƒì„¸ í†µê³„ íŒì—… ê¸°ëŠ¥ (ë³€ê²½ ì—†ìŒ)
        // ----------------------------------------------------
        function showDetail(type) { 
            updateProgress(); 

            const popup = document.getElementById('detailPopup');
            const content = document.getElementById('popupContent');
            
            const titleMap = {
                'day': 'ì˜¤ëŠ˜', 
                'week': 'ì´ë²ˆ ì£¼', 
                'month': 'ì´ë²ˆ ë‹¬', 
                'year': document.getElementById('yearLabel').textContent + 'ë…„', 
                'life': 'ì‹œê°„ì˜ íë¦„'
            };

            const detailContent = detailData[type];
            const title = titleMap[type];
            
            if (detailContent) {
                content.innerHTML = `<h3>${title} ìƒì„¸ í†µê³„</h3>` + detailContent;
            } else {
                content.innerHTML = `<h3>${title} ìƒì„¸ í†µê³„</h3><p>ë°ì´í„° ì¤€ë¹„ ì¤‘... (ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”)</p>`;
            }

            popup.classList.add('visible');
            
            setTimeout(() => {
                document.addEventListener('click', closePopupOutside);
            }, 0);
        }

        function closePopup() {
            document.getElementById('detailPopup').classList.remove('visible');
            document.removeEventListener('click', closePopupOutside);
        }

        function closePopupOutside(event) {
            const popup = document.getElementById('detailPopup');
            const targetElement = event.target;
            
            if (!popup.contains(targetElement) && !targetElement.closest('.progress-container')) {
                closePopup();
            }
        }

        // ì´ˆê¸° ë¡œë”© ë° 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ ì„¤ì •
        window.onload = function() {
            updateProgress();
            loadAndApplyColor();
            setInterval(updateProgress, 1000);
        };

        document.addEventListener('DOMContentLoaded', () => {
            const popup = document.getElementById('detailPopup');
            popup.addEventListener('click', (e) => e.stopPropagation()); 
        });
    </script>
    </body>
</html>
